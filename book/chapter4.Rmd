---
title: "Bivariate data analysis and bivariate data vizualisation"
output: html_fragment
---

## Contingency tables (a.k.a. crosstabs) with tabyl

Use the `tabyl()` function from the `janitor` package. The first line creates the table. The rest formats the table (giving it a title, adding totals etc...).

```{r tabyl, echo=T, eval=F}

library(janitor)
mtcars %>% 
  tabyl(am, gear, show_na = FALSE) %>% 
  adorn_title("combined") %>% #both var names in the title
  adorn_totals("col") %>% #column totals
  adorn_totals("row") %>% #row totals
  adorn_percentages("col") %>% #columnwise, rowwise (row), or total percentages (all)
  adorn_pct_formatting(digits = 1) %>%
  adorn_ns() #show the numbers of cases

```


## Box plots for different groups using ggplot

For a boxplot use `geom_boxplot()`:

```{r geomboxplot2, echo=T, eval=F}

# A boxplot comparing different species is having two variables in the aesthetics

iris %>% 
  ggplot(aes(x = Species, y = Petal.Width)) +
  geom_boxplot()

``` 


## Scatterplots with ggplot

A scatter plot in the ggplot package will be done with the geom `geom_point()`. Notice that the aesthetics in the first layer now contain two variables.

```{r scatter, echo=T, eval=F}

mtcars %>% 
  ggplot(aes(x = cyl, y = mpg)) + 
  geom_point()

```

If you want to add a linear regression line, add an extra 'geom' (geom_smooth).

```{r scatter_lm, echo=T, eval=F}

mtcars %>% 
  ggplot(aes(x = cyl, y = mpg)) + 
  geom_point() +
  geom_smooth(method = "lm", se = F)

```

If you want to visualize different groups in the scatterplot, you can add extra variables to the aesthetics. In addition to x and y, you can use color (the “outside” color of points), fill (the “inside” color of the points), shape (of points) and size.

```{r scatter with extra layers, echo=T, eval=F}

mtcars %>% 
  ggplot(aes(x = cyl, 
             y = mpg, 
             color = factor(gear)
             )
         ) + 
  geom_point()

```
  
  
## Descriptive measures and inferential statistics for associations (parametric)

For Pearson's r, we use 

```{r pearsons r, echo=T, eval=F, message=F}

cor.test(x = mtcars$mpg, 
    y = mtcars$disp,
    method = "pearson")

```
  
For an independent sample t-test (a linear model with a dummy as independent variable), in which both groups can be assumed to have an equal variance, we use: 

```{r independent sample t test, echo=T, eval=F, message=F}

# vs is a dummy and disp is a ratio variable in the data set mtcars
t.test(disp ~ vs, mtcars, var.equal = TRUE) 
# or use
lm(disp ~ vs, mtcars) %>% summary()

```

For an independent sample t-test in which both groups cannot be assumed to have equal variances, we use: 

```{r Welch, echo=T, eval=F, message=F}

# vs is a dummy and disp is a ratio variable in the data set mtcars
t.test(disp ~ vs, mtcars, var.equal = FALSE) 

```
  
  
## Inferential statistics for associations (non parametric)

For Cramer's V, we use
  
```{r cramers, echo=T, eval=F, message=F}

# install and load the package "rcompanion" first, this contains the command cramerV.
# this function works on tables, so create a table first

library("rcompanion")
my_table <- table(mtcars$vs, mtcars$am)
cramerV(my_table, ci = TRUE)
```

For Kendall's tau b, we use 

```{r kendall, echo=T, eval=F, message=F}

cor.test(x = mtcars$mpg, 
    y = mtcars$gear,
    method = "kendall")
```

For Spearman's rho, we use 

```{r spearman, echo=T, eval=F, message=F}

cor.test(x = mtcars$mpg, 
    y = mtcars$disp,
    method = "spearman")

```

For a chi-square test, we use 

```{r chi square, echo=T, eval=F, message=F}

# assuming the data are in vector x and vector y2
csq <- chisq.test(data$x, data$y2)
csq

# after calculating chi square by hand, 
# you can find the associated p-value by using:
chisq <- 3.86 # put the number you find here
df <- 1 # put the degrees of freedom here
pchisq(chisq, df, lower.tail = FALSE) # this gives the p-value

```


For a non-parametric test for comparing the medians of two or more groups, we use

```{r kruskallwallis, echo=T, eval=F}

airquality %>% 
  kruskal.test(Ozone ~ Month, data = .)

```
